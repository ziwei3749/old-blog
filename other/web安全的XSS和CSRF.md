# web安全的XSS和CSRF

## XSS

- XSS是什么? 有哪些攻击方式和攻击原理

xss是跨站脚本攻击。主要是利用你合法的渠道,向你的页面注入JS脚本,脚本里写它想要做的事情。

攻击方式分为2种:  反射型和存储型

```
反射型: 比如他把xss代码写到url里,xss作为请求参数传递给服务器

服务器解析这个参数,渲染到模板里,返回给浏览器。浏览器最终解析这个JS代码,从而XSS代码就生效了。
```

```

存储型,和反射型的区别就是。服务器得到那个XSS代码后,可能不一定会渲染。

也可能会做SQL语句,比如把参数存储到数据库了。

```

当然了用谷歌浏览器去做测试的话,url里写xss代码,服务器去尝试解析。onclick这一类代码也不会被直接执行。浏览器也可以拦截一些具有XSS工攻击的效果。

res.set('x-xss-protection':0)就关闭了浏览器的拦截XSS功能。


- XSS如何去做好防范措施?

    +  以用户评论这个功能举例的话。就是用户输入评论时,要用转义字符做转义。比如<转成&lt,>转成&gt。这个工作前端或者后端都可以做。
    +  如果是展示用户评论的这个接口的话。展示的时候呢,也不能直接反转义回来。可以domparse.js去转义,转义过程中呢,过滤那个一些onclick事件属性或者script/style/link标签。
    +  或者说,如果你前端通过innerHTML来渲染评论的话,最好不要改用innerText。(因为不太清楚是用ajax做着功能,还是后端渲染页面。)
    
    


## CSRF

- CSRF是什么?有哪些攻击手段和攻击原理

CSRF: 是跨站请求伪造。主要就是盗用cookie去其他的网站做一些操作。

举例来说: 

```
用户先去访问了新浪。那新浪的服务就set-cookie分配了一个cookie给浏览器。然后再去登录恶意网站,点击一些引诱点击的btn,可能就会去新浪网发起一个关注xxx的请求。

因为验证cookie是可以通过的,可能就真的关注某人,但是这个并不是用户想做的事情。

```

因为CSRF攻击利用的是,通过cookie验证请求,只能保证请求是来自某一个浏览器,但不能保证是用户本人的自愿发出的请求


- 防范措施:

(1) 请求某些接口需要用户输入验证码
(2) 验证 HTTP Referer 字段 ,HTTP请求头有这个字段,它是记录了HTTP请求的来源。如果来自陌生的网站请求可以,服务器可以拒绝响应。
```
每个浏览器对于Referer的具体实现可能有差别。
有些用户可能会开启浏览器防止跟踪功能，不提供Referer，从而导致正常用户请求被拒绝。
```
(3) token验证。把JWT放到request header里


JWT 由header/payload/签证组成。

header里包括token类型、加密算法
payload包括一些公共的声明和私有的声明。比如说token的过期时间、签发时间、用户的username
第三部分,是header和payload进行base64转码之后,再加盐去加密。组成第三部分。

这3个部分用.来链接,就形成jwt



设置了httponly,JS是无法获取cookie的
           
     






